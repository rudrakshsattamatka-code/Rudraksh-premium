<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rudraksh - Plans</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        .plan { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 8px; }
        .btn { display: inline-block; background-color: #25D366; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; }
        .contact { margin-top: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
        #logout { float: right; cursor: pointer; color: blue; }
    </style>
</head>
<body>
    <span id="logout">Logout</span>
    <h1>Subscription Plans</h1>
    <div id="plansContainer">
        <!-- Plans will be loaded from Firestore or hardcoded -->
    </div>
    <div class="contact" id="contactInfo">
        <!-- Contact info from Firestore -->
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = { /* your config */ };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Logout
        document.getElementById('logout').addEventListener('click', () => auth.signOut());

        // Check auth
        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = 'index.html';
            } else {
                loadPlansAndContact();
            }
        });

        async function loadPlansAndContact() {
            // Load site content from Firestore (subscriptionPage document)
            const contentDoc = await db.collection('siteContent').doc('subscriptionPage').get();
            let contact = { whatsapp: "1234567890", text: "Contact us" };
            if (contentDoc.exists) {
                const data = contentDoc.data();
                contact = data;
                // You can also load plans from data if you store them dynamically
            }

            // For simplicity, we'll hardcode plans but you can make them editable by storing in Firestore
            const plans = [
                { name: "Basic", price: "₹499", features: ["Market 1-3", "Email support"] },
                { name: "Pro", price: "₹999", features: ["All 7 markets", "Priority support"] },
                { name: "Premium", price: "₹1999", features: ["All markets + historical data", "24/7 support"] }
            ];

            let html = '';
            plans.forEach(p => {
                html += `<div class="plan">
                    <h3>${p.name}</h3>
                    <p>Price: ${p.price}</p>
                    <ul>${p.features.map(f => `<li>${f}</li>`).join('')}</ul>
                    <button class="btn" onclick="payViaWhatsApp('${p.name}', '${p.price}')">Pay via WhatsApp</button>
                </div>`;
            });
            document.getElementById('plansContainer').innerHTML = html;

            // Contact info
            document.getElementById('contactInfo').innerHTML = `
                <h3>Contact</h3>
                <p>${contact.text || 'For queries or payment confirmation'}</p>
                <p>WhatsApp: <a href="https://wa.me/${contact.whatsapp}">${contact.whatsapp}</a></p>
            `;
        }

        window.payViaWhatsApp = function(plan, price) {
            // Get WhatsApp number from Firestore (or use a default)
            db.collection('siteContent').doc('subscriptionPage').get().then(doc => {
                let number = "1234567890"; // fallback
                if (doc.exists && doc.data().whatsapp) {
                    number = doc.data().whatsapp;
                }
                const message = `I want to subscribe to the ${plan} plan (${price}). I have sent the payment. Please find the screenshot attached.`;
                const url = `https://wa.me/${number}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            });
        };
    </script>
</body>
</html>
