<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Choose Plan</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; }
        .plan-btn { width: 100%; padding: 16px; margin: 10px 0; font-size: 18px; border: none; border-radius: 8px; background: #2196F3; color: white; cursor: pointer; }
        .plan-btn:hover { background: #1976D2; }
        .qr-placeholder { background: #eee; height: 200px; display: flex; align-items: center; justify-content: center; margin: 20px 0; border-radius: 8px; }
        .qr-placeholder img { max-width: 100%; max-height: 100%; }
        .whatsapp { text-align: center; font-size: 18px; margin: 15px 0; }
        .submit-btn { width: 100%; padding: 16px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; }
        .back-btn { margin-top: 10px; background: #f44336; }
        .message { text-align: center; color: green; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2 id="siteHeadline">RUDRAKSH PREMIUM</h2>
        <p>Select your plan:</p>
        <button class="plan-btn" onclick="selectPlan('1day', 1100)">1 Day – ₹1100</button>
        <button class="plan-btn" onclick="selectPlan('7days', 5100)">7 Days – ₹5100</button>

        <div class="qr-placeholder" id="qrCode">
            <!-- Replace this placeholder with your actual QR code image URL -->
            <img src="https://via.placeholder.com/200?text=QR+Code" alt="QR Code">
        </div>

        <div class="whatsapp" id="whatsappDisplay">
            WhatsApp: <strong id="whatsappNumber">9328435505</strong>
        </div>

        <p>After payment, send screenshot to the WhatsApp number above, then click:</p>
        <button class="submit-btn" onclick="submitPayment()">I have paid</button>
        <button class="submit-btn back-btn" onclick="logout()">Logout</button>
        <p class="message" id="message"></p>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCXL6EiiLg_3lILCOSA_iFgeL8Y2nPEEnw",
            authDomain: "rudraksh-premium.firebaseapp.com",
            projectId: "rudraksh-premium",
            storageBucket: "rudraksh-premium.firebasestorage.app",
            messagingSenderId: "99880475040",
            appId: "1:99880475040:web:c64c708e9bec7fed0a6cc5"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let selectedPlan = null;
        let settings = {};

        db.collection('siteSettings').doc('settings').get().then(doc => {
            if (doc.exists) {
                settings = doc.data();
                document.getElementById('siteHeadline').innerText = settings.headline || 'RUDRAKSH PREMIUM';
                document.getElementById('whatsappNumber').innerText = settings.whatsappNumber || '9328435505';
                // If you have a QR code image URL stored in settings, you can set it here:
                // if (settings.qrUrl) document.querySelector('#qrCode img').src = settings.qrUrl;
            }
        });

        function selectPlan(plan, amount) {
            selectedPlan = plan;
            alert(`Selected ${plan === '1day' ? '1 Day' : '7 Days'} plan. Please pay ₹${amount} and send screenshot.`);
        }

        function submitPayment() {
            const user = auth.currentUser;
            if (!user) { window.location.href = 'login.html'; return; }
            if (!selectedPlan) { alert('Please select a plan first.'); return; }

            db.collection('payments').add({
                userId: user.uid,
                userEmail: user.email,
                plan: selectedPlan,
                status: 'pending',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('message').innerText = 'Request submitted! Waiting for admin approval.';
                setTimeout(() => { window.location.href = 'waiting.html'; }, 2000);
            }).catch(error => {
                alert(error.message);
            });
        }

        function logout() {
            auth.signOut().then(() => window.location.href = 'login.html');
        }

        auth.onAuthStateChanged(user => {
            if (!user) window.location.href = 'login.html';
        });
    </script>
</body>
</html>
